## `this`

在函数中 `this` 到底取何值，是在函数真正被调用执行的时候确定的，函数定义的时候确定不了。

1. 场景1：全局 & 调用普通函数

在全局环境下， `this` 始终是全局对象本身。

普通函数在浏览器全局环境中被简单调用，非严格模式下 `this` 指向window; 在 `use strict` 指明严格模式的情况下就是 `undefined`。

2. 场景2：上下文对象调用中的  `this` 

在执行函数时，如果函数中的 `this` 是被上一级的对象所调用，那么 `this` 指向的就是上一级的对象；否则指向全局对象。

3. 场景3：`bind/call/apply` 改变  `this`  指向

当一个函数被 `bind/call/apply` 调用时， `this` 的值就取传入的对象的值。

但是对 `call/apply/bind` 的高级考察往往会结合构造函数以及组合式实现继承。

4. 场景 4：构造函数和  `this` 

如果构造函数中显式返回一个值，且返回的是一个对象，那么  `this`  就指向这个返回的对象；如果返回的不是一个对象，那么  `this`  仍然指向实例。

在构造函数的 `prototype` 中，以及在整个原型链中， `this` 代表的也都是当前对象的值。

5. 箭头函数中的  `this`  指向

箭头函数使用 `this` 不适用以上标准规则，而是根据外层（函数或者全局）上下文作用域来决定。

6.  `this`  优先级相关

把通过 `call、apply、bind、new` 对  `this`  绑定的情况称为显式绑定；根据调用关系确定的  `this`  指向称为隐式绑定。

`call、apply` 的显式绑定一般来说优先级比隐式绑定更高。

`new` 绑定修改了 `bind` 绑定中的  `this` ，因此 `new` 绑定的优先级比显式 `bind` 绑定更高。

[JavaScript 的  `this`  原理是什么？](https://www.zhihu.com/question/353757734/answer/964557747)


[面试官：说说执行上下文吧](https://juejin.cn/post/6844904158957404167)

[理解 JavaScript 的执行上下文这篇就够了！](https://juejin.cn/post/6954966248233009182)

[理解 JavaScript 中的执行上下文和执行栈](https://juejin.cn/post/6844903682283143181)

## 执行上下文 / 执行上下文环境

在 `ECMASscript` 中的代码有三种类型：`global, function和eval`。

在一段 `js` 代码拿过来真正一句一句运行之前，浏览器已经做了一些“准备工作”，其中就包括对变量的声明，而不是赋值。变量赋值是在赋值语句执行的时候进行的。

在“准备工作”中完成的工作：

  - 变量、函数表达式 —— 变量声明，默认赋值为 `undefined`；
  - ` `this` ` —— 赋值；
  - 函数声明 —— 赋值；

这三种数据的准备情况称之为“执行上下文”或者“执行上下文环境”。

在函数体的语句执行之前，arguments变量和函数的参数都已经被赋值。从这里可以看出，函数每被调用一次，都会产生一个新的执行上下文环境。因为不同的调用可能就会有不同的参数。

另外一点不同在于，函数在定义的时候（不是调用的时候），就已经确定了函数体内部自由变量的作用域。

  - 全局执行上下文 — 这是默认或者说基础的上下文，任何不在函数内部的代码都在全局上下文中。它会执行两件事：创建一个全局的 window 对象（浏览器的情况下），并且设置  `this`  的值等于这个全局对象。一个程序中只会有一个全局执行上下文。

  - 函数执行上下文 — 每当一个函数被调用时, 都会为该函数创建一个新的上下文。每个函数都有它自己的执行上下文，不过是在函数被调用时创建的。函数上下文可以有任意多个。每当一个新的执行上下文被创建，它会按定义的顺序（将在后文讨论）执行一系列步骤。

  - Eval 函数执行上下文 — 执行在 eval 函数内部的代码也会有它属于自己的执行上下文，但由于 JavaScript 开发者并不经常使用 eval，在这里不讨论它。

## 执行上下文栈

执行全局代码时，会产生一个执行上下文环境，每次调用函数都又会产生执行上下文环境。当函数调用完成时，这个上下文环境以及其中的数据都会被消除，再重新回到全局上下文环境。处于活动状态的执行上下文环境只有一个。

其实这是一个压栈出栈的过程——执行上下文栈

