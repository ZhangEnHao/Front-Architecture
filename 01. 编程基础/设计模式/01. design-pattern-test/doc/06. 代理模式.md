## 介绍

- 使用者无权访问目标对象

- 中间加代理，通过代理做授权和控制

## UML 类题

```JavaScript
class ReadImg {
  constructor(fileName) {
    this.fileName = fileName;
    this.loadFromDisk();
  }
  loadFromDisk() {
    console.log(`loading img...`);
  }

  display() {
    console.log(`display img...`);
  }
}

class ProxyImg {
  constructor(fileName) {
    this.realImg = new ReadImg(fileName)
  }
  display() {
    this.realImg.display()
  }
}

// test
let proxyImg = new ProxyImg("1.png");
proxyImg.display()
```


## 场景

1. 网页事件代理

```HTML
<div id="box">
  <a href="#">a1</a>
  <a href="#">a2</a>
  <a href="#">a3</a>
  <a href="#">a4</a>
  <a href="#">a5</a>
</div>
<script>
let box = document.getElementById("box");
box.addEventListener("click", function() {
  let target = e.target
  if(target.nodeName === "A") {
    alert(target.innerHTML)
  }
})
</script>
```

2. JQuery $.proxy

```JavaScript
$("#box").click(function() {
  setTimeOut($.proxy(function(){
    $(this).css("backgroundCColor", "yellow")
  }, this), 1000)
})
```

3. ES6 Proxy

```JAvaScript
// 明星
let star = {
  name: "ABC",
  age: 24,
  phone: "star phone: 12345678909"
}

// 经纪人
let agent = new Proxy(star, {
  get: function(target, key) {
    if(key === "phone") {
      // 返回经纪人电话
      return `agent phone: 09876543212`
    }else if(key === "price") {
      return 120000
    }
    return target[key]
  },
  set: function(target, key, val) {
    if(key === "customPrice") {
      if(val < 100000) {
        throw new Error("价格太低了")
      }else {
        target[key] = val;
        return true
      }
    }
  }
})

// test
console.log(agent.name);
console.log(agent.phone);
console.log(agent.price);
agent.customPrice = 900000;
console.log(agent.customPrice);
agent.customPrice = 900;
console.log(agent.customPrice);

```


## 设计原则验证

- 代理类和目标类分离，隔离开目标类和使用者

- 符合开放封闭原则



